# `ubrn build` generates a Rust wasm crate in rust_modules/wasm, with `wasm-bindgen` annotated functions.
# That crate is used to generate TS bindings which call into the `wasm-bindgen` functions.
# Because that generated crate doesn't belong to the `payjoin` workspace, we need to patch the generated Cargo.toml accordingly for local development.
# The patch is applied via the ubrn.config.yaml `manifestPatchFile` option.
# The paths below are relative to payjoin-ffi/javascript/rust_modules/wasm/Cargo.toml
[dependencies]
# Pin wasm-bindgen to match the CLI version in .github/workflows/javascript.yml.
# The generated template uses "*", which resolves to latest. A mismatch between
# the library and CLI versions causes "unreachable" panics at runtime.
wasm-bindgen = "=0.2.108"

# uniffi_core 0.30 requires this feature for wasm32 builds to remove the
# Send bound on futures, which is not applicable in single-threaded WASM.
[dependencies.uniffi_core]
version = "0.30"
default-features = false
features = ["wasm-unstable-single-threaded"]

[patch.crates-io]
payjoin = { path = "../../../../payjoin" }
payjoin-directory = { path = "../../../../payjoin-directory" }
payjoin-test-utils = { path = "../../../../payjoin-test-utils" }
# uniffi-runtime-javascript is not yet published with uniffi_core 0.30 support.
# This path patch lets cargo resolve it from the installed npm package.
uniffi-runtime-javascript = { path = "../../node_modules/uniffi-bindgen-react-native/crates/uniffi-runtime-javascript" }
